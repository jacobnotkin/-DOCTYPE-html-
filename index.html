const selections = { 
    country: "", 
    industry: "", 
    businessData: { name: "", phone: "" },
    agentType: "",
    isPaid: false 
};

// 1. UPDATED MENU STRUCTURE
const menus = {
    1: { t: "Select Country", k: "country", opts: ["United States", "United Kingdom", "Canada", "Australia", "Germany", "France", "Global..."] },
    2: { t: "Industry Type", k: "industry", opts: ["Dental Office", "Roofing Company", "Real Estate", "Hair Salon", "Law Firm"] },
    4: { t: "Agent Role", k: "agentType", opts: ["Receptionist", "Appointment Booker", "Lead Qualifier", "Customer Support"] }
};

// 2. TRIGGER MODAL LOGIC
function triggerModal(step) {
    const m = document.getElementById('setupModal');
    const content = document.getElementById('mContent');
    m.style.display = 'flex';
    content.innerHTML = "";

    if (menus[step]) {
        document.getElementById('mTitle').innerText = menus[step].t;
        menus[step].opts.forEach(opt => {
            let b = document.createElement('button');
            b.className = "w-full py-3 px-6 rounded-xl bg-white/5 text-white font-bold hover:bg-orange-600 transition-all text-left flex justify-between";
            b.innerHTML = `<span>${opt}</span> <span>→</span>`;
            b.onclick = () => finishStep(step, opt, menus[step].k);
            content.appendChild(b);
        });
    } else if (step == 3) {
        document.getElementById('mTitle').innerText = "Business Credentials";
        content.innerHTML = `
            <input id="bName" placeholder="COMPANY NAME" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl text-white mb-3 outline-none focus:border-orange-500">
            <input id="bPhone" placeholder="CURRENT PHONE NUMBER" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl text-white mb-6 outline-none focus:border-orange-500">
            <button onclick="saveBusinessData()" class="w-full bg-orange-600 p-4 rounded-xl text-white font-black uppercase">Save & Continue</button>`;
    } else if (step == 5) {
        // STEP 5: DEMO CALL LOGIC
        document.getElementById('mTitle').innerText = "Live Demo Session";
        content.innerHTML = `
            <div class="p-6 bg-orange-600/10 border border-orange-500/50 rounded-2xl mb-4">
                <p class="text-xs text-orange-500 font-bold mb-2 uppercase">Your Temporary Demo Line:</p>
                <p class="text-2xl font-black text-white">+1 (888) AI-PORT-1</p>
            </div>
            <p class="text-slate-400 text-sm mb-6 italic text-left">Call the number above to speak with your ${selections.agentType || 'Agent'}. Tell it your name is ${selections.businessData.name || 'a customer'}.</p>
            <button onclick="closeM(); document.getElementById('s5').classList.add('active');" class="w-full bg-white text-black p-4 rounded-xl font-black uppercase">I Have Finished The Call</button>`;
    } else if (step == 6) {
        // STEP 6: ACTIVATION & PAYMENT
        document.getElementById('mTitle').innerText = "Activate Infrastructure";
        content.innerHTML = `
            <p class="text-slate-400 mb-6">Authorize your $199/mo subscription to go live.</p>
            <button onclick="handlePayment()" class="w-full bg-green-600 p-6 rounded-2xl text-white font-black text-xl shadow-lg">PAY & LAUNCH DASHBOARD</button>`;
    }
}

// 3. PAYMENT & DASHBOARD REDIRECT
function handlePayment() {
    const btn = event.target;
    btn.innerText = "PROCESSING...";
    
    // Simulate Stripe Success
    setTimeout(() => {
        alert("Payment Successful! Redirecting to your Dashboard...");
        // In a real app: window.location.href = "/dashboard";
        showDashboardView(); 
    }, 2000);
}

function showDashboardView() {
    // This function would hide the Hero and show the operational dashboard
    document.querySelector('.grid').innerHTML = `
        <div class="col-span-full bg-white/5 p-8 rounded-[40px] border border-orange-500/20">
            <h2 class="text-2xl font-black mb-4">Welcome to your Control Center, ${selections.businessData.name}</h2>
            <div class="grid md:grid-cols-3 gap-4">
                <div class="bg-black/40 p-6 rounded-2xl border border-white/5 text-left">
                    <p class="text-[10px] text-orange-500 font-bold uppercase mb-2">Voice Settings</p>
                    <select class="bg-transparent text-white font-bold outline-none w-full"><option>Professional Male</option><option>Warm Female</option></select>
                </div>
                <div class="bg-black/40 p-6 rounded-2xl border border-white/5 text-left">
                    <p class="text-[10px] text-orange-500 font-bold uppercase mb-2">Active Language</p>
                    <select class="bg-transparent text-white font-bold outline-none w-full"><option>English (US)</option><option>Spanish</option></select>
                </div>
                <div class="bg-black/40 p-6 rounded-2xl border border-white/5 text-left">
                    <p class="text-[10px] text-orange-500 font-bold uppercase mb-2">Live Status</p>
                    <span class="text-green-500 font-bold">● ACTIVE</span>
                </div>
            </div>
        </div>
    `;
    closeM();
}
